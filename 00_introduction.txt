Introduction

This GitHub repository contains the scripts and files necessary to reproduce the mRNA-seq
differential gene expression analysis from Collins et al. (2023), and the subsequent comparison
of lists of differentially expressed genes (DEGs) from Collins et al. (2023) and other studies.

The analysis assumes that the GitHub repository and raw mRNA-seq read files have been 
downloaded from davidprince84/Collins-et-al_NE-R000875-1_obj1_mRNA-seq_scripts
 and GEO GSE172422 respectively.

Software used for this analysis:
clusterProfiler v4.2.2 (R package)  
DESeq2 v1.34.0 (R package) 
eulerr v6.1.1 (R package)
FastQC v0.11.9 
ggplotify v0.1.0 (R package) 
ggplot2 v3.3.6 (R package) 
ggpubr v0.4.0 (R package) 
ggrepel v0.9.1 (R package)
GOSemSim v2.20.0 (R package) 
HISAT2 v2.1.0 
kallisto v0.46.1 
Mikado v2.0rc2 (python library) 
MultiQC v1.9 (python library) 
org.Dm.eg.db v3.14.0 (R package) 
OrthoFinder v2.5.2 
pheatmap v1.0.12 (R package) 
python v3.7 
R v4.1.3 
reshape2 v1.4.4 (R package) 
RSeQC v3.0.1 (python library) 
samtools v1.10 
tidyr v1.2.0 (R package)
tximport v1.22.0 (R package)  

Datasets included in the GitHub repository:
chen_2014_table_s1.csv - Table S1 from Chen et al. (2014) containing list of genes that are differentially expressed in 
			 the fat body from 50-day-old wild-type flies.
korb_2021_table_s1.csv - Table S1 from Korb et al. (2021) containing genes from interacting endocrine pathways that are 
			 involved in the TI-J-LiFe  (TOR/IIS-JH-Lifespan and Fecundity) network. 
kramer_2021_table_s3.csv - Table S3 from Kramer et al. (2021) containing genes known to be major components of the
			   enzymatic antioxidant network.
pacifico_2018_table_s1_female.csv - The "Female" Excel tab from Table S1 of Pacifico et al. (2018) containing lists of all 
				    differentially expressed genes in all pairwise age comparisons.
virus_samples.csv - A list of the mRNA-seq samples in the study that were found to have a large number slow bee paralysis virus (SBPV) reads.					 

Overview of the numbered scripts:

General notes: The scripts were written on a Windows PC, therefore it is advisable to run dos2unix on the scripts 
	       before running them in Unix.
	     : Scripts 01, 08, f_SumT2GBuildDDS.R and f_BuildDDSForDEAnalysis.R require the user to change a file path to make it
	       specific to their own computer. These instances are highlighted with PLEASE CHANGE in the comments.
	     : Scripts whose names end with "tissue" need to be run with an argument denoting which tissue is to be
	       analysed. E.g:
	       ./10_quality_control_fastqc_tissue.bash brain 
	       would run script 10 on the brain samples. The other tissue arguments are fatbody and ovary.
	     : Scripts whose name starts with "f_" are custom R functions called from multiple R scripts. 

Scripts 01 to 08 perform necesary preliminary tasks such as downloading genome-related files and indexing them, 
or downloading datasets for comparison.
01: Initiates directory structure for the rest of the analysis, moves the scripts and data sets into the
    correct directories. NOTE: instructions included for moving mRNA-seq files to correct directory.
02: Downloads fasta and gtf files for Bombus terrestris, and fasta files for Apis mellifera and Drosophila melanogaster, 
    along with associated checksums files. Also downloads Holobee fasta files.
03: Verifies the integrity of the downloaded files using md5sums/checksums.
04: Indexes the B. terrestris genome and transcriptome for HISAT2 and Kallisto respectively. 
    Indexes the Holobee fasta file with Kallisto.
05: Uses the B. terrestris GTF to produce a file linking transcript and gene IDs,
    for use with tximport. Generates a BED12 file from the GTF using Mikado, for use with RSeQC.
06: Uses the B. terrestris feature table to produce a table where gene symbols are linked to gene names.
07: Downloads and formats the details for Drosophila melanogaster genes in the GenAge database.
08: Conducts OrthoFinder analysis on peptide sequences from B. terrestris, Apis mellifera and D. melanogaster.

Scripts 10 to 18 perform quality control tasks such as examining read quality with FastQC, checking alignment of reads
to the genome, pseudoalignment of reads to the transcriptome, and clustering samples with a principal component analysis (PCA).
10: Conducts FastQC analysis on the mRNA-seq reads and combines the results into a single report with MultiQC for the specified tissue. 
11: Aligns the mRNA-seq reads to the B. terrestris genome using HISAT2 and combines the results into a single report with MultiQC for the specified tissue.
12: Examines the quality of the alignments generated by script #11 using RSeQC for the specified tissue.
13: Pseudoaligns the mRNA-seq reads to the Holobee barcode fasta file with Kallisto for the specified tissue.
14: Compares pseudoalignment with Kallisto to Holobee sequences and alignment with HISAT2 to B. terrestris genome for mRNA-seq libraries for each tissue.
15: Pseudoaligns the mRNA-seq reads to the B. terrestris transcriptome with Kallisto for the specified tissue.
16: Produces a principal component analysis (PCA) to visualise clustering of sequencing technical replicates.
17: Produces a principal component analysis (PCA) to visualise clustering of samples with many virus-aligning reads relative to the other samples. 
18: Produces plots to visualise the normalization and clustering of samples in the differential expression analysis.

Scripts 20 to 27 perform differential expression analysis and gene ontology (GO) enrichment analysis on the mRNA-seq data
from the current study, and assesses the impact of samples with virus on the differential gene expression analysis.
20: Produces figures with summary plots and tables for the differential expression analysis.
21: Produces a table of the differential expression analysis and lists of differentially expressed genes for each tissue when comparing within treatments.
22: Produces heatmaps of the differential expression analysis for each tissue when comparing within treatments.
23: Performs gene ontology (GO) enrichment analysis on lists of differentially expressed genes from the current study when comparing within treatments, and produces tables of enriched GO terms.
24: Combines the GO enrichment results from script #23 into a single table.
25: Produces lists of differentially expressed genes for each tissue when comparing between treatments.
26: Compares the differentially expressed genes returned if all samples, samples with virus, or samples without virus (no virus) samples are used.
27: Produces Euler diagrams summarising the results of script #26.

Scripts 30 to 32 compare the differentially expressed genes between treatments within tissues.
30: Compares the lists of DEGs between treatments within tissues, and produces tables of statistical results and overlapping genes.
31: Produces Euler diagrams summarising the results of script #30.
32: Compares the lists of DEGs between chronological ages within tissues, and produces tables of statistical results and overlapping genes.

Scripts 40 to 47 compare the differentially expressed genes from the current study to lists of genes potentially associated with 
longevity in other insect species.
40: Prepares Drosophila melanogaster GenAge data for comparison with data from the current study in scripts #41 and #42.
41: Compares data from the current study to the Drosophila melanogaster orthologues of genes in the GenAge database, and produces a heatmap of the results.
42: Compares data from the current study to the Drosophila melanogaster orthologues of genes in the GenAge database, and produces a table of the results of statistical
    tests, and a table listing overlapping genes.
43: Compares data from the current study to the Drosophila melanogaster orthologues of genes in the TI-J-LiFe network, and produces a table of the 
    results of statistical tests, and a table listing overlapping genes.
44: Compares data from the current study to the Drosophila melanogaster orthologues of genes in the TI-J-LiFe network, and produces a heatmap 
    of the results.
45: Compares data from the current study to the Drosophila melanogaster orthologues of genes in the enzymatic antioxidant network, and produces a table of the 
    results of statistical tests, and a table listing overlapping genes.
46: Compares data from the current study to the Drosophila melanogaster orthologues of genes in the enzymatic antioxidant network, and produces a heatmap 
    of the results.
47: Compares data from the current study to the Drosophila melanogaster orthologues of differentially expressed genes in Chen et al. (2014) and
    Pacifico et al. (2018), and produces a table of the results of statistical tests, and a table listing overlapping genes.

Script 50 gathers all the tables and figures from the analysis that are present in the manuscript, and copies them to a single folder for convenience.
